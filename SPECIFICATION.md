# Linkre 機能仕様書

**Version**: 1.0.0  
**作成日**: 2025年1月  
**対象ブラウザ**: Google Chrome (Manifest V3)  

## 📋 目次

1. [概要](#概要)
2. [機能要件](#機能要件)
3. [技術仕様](#技術仕様)
4. [ユーザーインターフェース](#ユーザーインターフェース)
5. [セキュリティ・プライバシー](#セキュリティプライバシー)
6. [国際化対応](#国際化対応)
7. [エラーハンドリング](#エラーハンドリング)
8. [パフォーマンス要件](#パフォーマンス要件)
9. [配布・インストール](#配布インストール)

---

## 概要

### 製品名
**Linkre** (リンクル)

### 製品概要
ウェブページから特定のリンクを効率的に収集・コピーするためのChrome拡張機能。4つの異なるフィルタリング方法を提供し、ユーザーが条件に合致するリンクを一括で取得できる。

### 主要な価値提案
- 手動でのリンクコピー作業を自動化
- 複数のフィルタリング方法による柔軟な検索
- ワンクリックでの一括コピー機能
- 設定の永続化によるワークフロー効率化

### 対象ユーザー
- 研究者・学術関係者
- Web開発者
- コンテンツクリエイター
- デジタルマーケター
- 情報収集を行う一般ユーザー

---

## 機能要件

### 1. 核心機能

#### 1.1 リンクスキャン機能
- **機能ID**: F001
- **説明**: 現在表示中のウェブページから全てのハイパーリンクを抽出
- **詳細**:
  - `<a href="...">` タグを自動検出
  - 相対URLを絶対URLに自動変換
  - リンクテキストとURL の両方を取得
  - 重複リンクの処理

#### 1.2 フィルタリング機能
- **機能ID**: F002
- **説明**: 4つの方法でリンクをフィルタリング

##### 1.2.1 ドメインフィルタリング
- **入力**: ドメイン名 (例: `github.com`)
- **動作**: 指定されたドメインを含むURLのみを抽出
- **マッチング**: 部分一致、大小文字区別なし
- **例**: `github.com` → `https://github.com/user/repo`

##### 1.2.2 テキストフィルタリング
- **入力**: 検索文字列 (例: `ダウンロード`)
- **動作**: リンクテキストに指定文字列を含むリンクを抽出
- **マッチング**: 部分一致、大小文字区別なし
- **例**: `PDF` → `<a href="...">PDF版はこちら</a>`

##### 1.2.3 URLパターンフィルタリング
- **入力**: URLパターン文字列 (例: `.pdf`)
- **動作**: URL内に指定パターンを含むリンクを抽出
- **マッチング**: 部分一致、大小文字区別なし
- **例**: `/download/` → `https://example.com/download/file.zip`

##### 1.2.4 正規表現フィルタリング
- **入力**: 正規表現パターン (例: `\.pdf$`)
- **動作**: 正規表現にマッチするURLを抽出
- **フラグ**: 大小文字区別なし (`i` フラグ)
- **エラーハンドリング**: 無効な正規表現の場合はエラー表示

#### 1.3 コピー機能
- **機能ID**: F003
- **説明**: フィルタリングされたリンクをクリップボードにコピー

##### 1.3.1 選択コピー
- ユーザーが選択したリンクのみをコピー
- チェックボックスによる個別選択
- 複数選択対応

##### 1.3.2 一括コピー
- フィルタリング結果の全リンクを一括コピー
- ワンクリックでの高速処理

##### 1.3.3 フォーマット
- 各リンクを改行で区切り
- プレーンテキスト形式
- 絶対URL形式で出力

#### 1.4 結果表示機能
- **機能ID**: F004
- **説明**: スキャン結果をユーザーフレンドリーに表示
- **要素**:
  - リンクURL
  - リンクテキスト
  - 選択チェックボックス
  - スクロール可能なリスト表示

#### 1.5 クリア機能
- **機能ID**: F005
- **説明**: 表示されているスキャン結果をクリア
- **動作**:
  - 結果リストの削除
  - ボタン状態のリセット
  - ステータスメッセージのクリア

### 2. 補助機能

#### 2.1 設定永続化
- **機能ID**: F006
- **説明**: ユーザーの設定を保存・復元
- **保存内容**:
  - 最後に使用したフィルタータイプ
  - フィルター検索値
- **保存場所**: Chrome Storage API (ローカル)

#### 2.2 ステータス表示
- **機能ID**: F007
- **説明**: 操作結果をユーザーに通知
- **種類**:
  - 成功メッセージ (緑色)
  - エラーメッセージ (赤色)
- **自動消去**: 3秒後に自動消去

#### 2.3 ヘルプ表示
- **機能ID**: F008
- **説明**: 正規表現使用時のヘルプテキスト表示
- **内容**: 使用例とサンプルパターン

---

## 技術仕様

### 1. アーキテクチャ

#### 1.1 Chrome Extension構成
- **Manifest Version**: 3
- **アーキテクチャ**: MV3準拠
- **主要コンポーネント**:
  - Popup (UI)
  - Content Script (ページ解析)
  - Background Script (最小限)

#### 1.2 ファイル構成
```
linkre/
├── manifest.json          # 拡張機能設定
├── popup.html             # メインUI
├── popup.js               # UIロジック
├── content.js             # ページスキャン機能
├── content.css            # コンテンツスタイル
├── background.js          # バックグラウンド処理
├── icons/                 # アイコンファイル
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── _locales/              # 国際化ファイル
    ├── en/messages.json
    └── ja/messages.json
```

### 2. 技術スタック

#### 2.1 フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: モダンレイアウト、Flexbox
- **JavaScript (ES6+)**: モジュール、async/await

#### 2.2 Chrome APIs
- **chrome.tabs**: アクティブタブアクセス
- **chrome.storage**: 設定保存
- **chrome.i18n**: 国際化
- **navigator.clipboard**: クリップボード操作

#### 2.3 外部依存関係
- なし（純粋なJavaScript実装）

### 3. データフロー

#### 3.1 リンクスキャンフロー
```
1. User clicks "Scan Links"
2. Popup → Content Script (chrome.tabs.sendMessage)
3. Content Script scans DOM for <a> tags
4. Content Script filters links based on criteria
5. Content Script → Popup (response)
6. Popup displays filtered results
```

#### 3.2 設定保存フロー
```
1. User changes filter settings
2. Popup saves to chrome.storage.local
3. Next session: Popup loads from storage
4. UI state restored automatically
```

---

## ユーザーインターフェース

### 1. 画面設計

#### 1.1 ポップアップサイズ
- **幅**: 350px
- **高さ**: 可変 (最大600px)
- **レスポンシブ**: なし (固定サイズ)

#### 1.2 レイアウト構成
```
┌─────────────────────────────────┐
│ フィルター設定                    │
│ ○ ドメインで絞り込み               │
│ ○ リンクテキストで絞り込み          │
│ ○ URL パターンで絞り込み          │
│ ○ 正規表現で絞り込み              │
│                                │
│ [入力フィールド]                  │
│ [ヘルプテキスト] (正規表現時のみ)   │
│                                │
│ [スキャン] [コピー] [全コピー] [クリア] │
│                                │
│ ┌───────────────────────────┐  │
│ │ 結果リスト                    │  │
│ │ ☑ Link 1                    │  │
│ │ ☑ Link 2                    │  │
│ │ ...                         │  │
│ └───────────────────────────┘  │
│                                │
│ [ステータスメッセージ]              │
└─────────────────────────────────┘
```

### 2. UI要素仕様

#### 2.1 フィルター選択
- **コンポーネント**: ラジオボタン
- **初期状態**: 未選択 (ユーザーに選択を促す)
- **動作**: 選択時に入力フィールドを有効化

#### 2.2 入力フィールド
- **初期状態**: 無効 (グレーアウト)
- **プレースホルダー**: フィルタータイプに応じて動的変更
- **バリデーション**: 正規表現の構文チェック

#### 2.3 ボタン群
- **スキャンボタン**: 主要アクション、青色
- **コピーボタン**: 結果がある時のみ有効
- **全コピーボタン**: 結果がある時のみ有効
- **クリアボタン**: 結果がある時のみ有効

#### 2.4 結果リスト
- **最大高さ**: 200px
- **スクロール**: 縦スクロールのみ
- **項目表示**: チェックボックス + リンクテキスト
- **ツールチップ**: リンクURL表示

### 3. カラーパレット
- **メインブルー**: #4285f4
- **成功グリーン**: #155724 (背景: #d4edda)
- **エラーレッド**: #721c24 (背景: #f8d7da)
- **テキストグレー**: #333
- **ボーダーグレー**: #ddd

---

## セキュリティ・プライバシー

### 1. プライバシー保護

#### 1.1 データ収集方針
- **データ収集**: 一切行わない
- **外部通信**: 一切行わない
- **トラッキング**: 一切行わない
- **ローカル処理**: 全ての処理をブラウザ内で完結

#### 1.2 アクセス権限
- **activeTab**: 現在のタブのリンクスキャンのみ
- **clipboardWrite**: コピー機能のみ
- **storage**: 設定保存のみ

#### 1.3 データ保持
- **設定データ**: ローカルストレージに保存
- **スキャンデータ**: メモリ内のみ、拡張機能終了時に削除
- **個人情報**: 一切取得・保存しない

### 2. セキュリティ対策

#### 2.1 入力検証
- 正規表現の構文チェック
- XSS攻撃対策（innerHTML使用時のサニタイゼーション）
- 悪意のあるURLの処理

#### 2.2 権限最小化
- 必要最小限の権限のみ要求
- バックグラウンド処理の最小化
- 不要なAPIアクセスの排除

---

## 国際化対応

### 1. サポート言語
- **英語 (en)**: デフォルト言語
- **日本語 (ja)**: 完全対応

### 2. 翻訳対象要素
- UI表示テキスト全て
- エラーメッセージ
- ヘルプテキスト
- プレースホルダーテキスト

### 3. 実装方式
- **Chrome i18n API**: `chrome.i18n.getMessage()`
- **リソースファイル**: `_locales/{lang}/messages.json`
- **動的言語切替**: ブラウザ設定に基づく自動選択

### 4. 翻訳キー例
```json
{
  "extensionName": {
    "message": "Linkre",
    "description": "Name of the extension"
  },
  "filterByDomain": {
    "message": "Filter by domain",
    "description": "Option to filter links by domain"
  }
}
```

---

## エラーハンドリング

### 1. エラー分類

#### 1.1 ユーザーエラー
- **無効な正規表現**: 構文エラーの表示
- **フィルター未選択**: 選択促進メッセージ
- **空の検索条件**: 条件入力要求

#### 1.2 システムエラー
- **通信エラー**: Content Scriptとの通信失敗
- **権限エラー**: 必要な権限が不足
- **ブラウザ非対応**: 古いブラウザでの動作

#### 1.3 ネットワークエラー
- **ページアクセス不可**: 該当なし（ローカル処理のため）

### 2. エラー表示方式
- **表示場所**: ステータスエリア
- **表示色**: 赤色背景
- **表示時間**: 手動クリアまで表示継続
- **多言語対応**: エラーメッセージも国際化

### 3. ログ出力
- **開発時**: `console.log()` でデバッグ情報
- **本番時**: エラー情報のみコンソール出力
- **ユーザーデータ**: ログに含めない

---

## パフォーマンス要件

### 1. 応答性能

#### 1.1 UI応答時間
- **ポップアップ表示**: 100ms以内
- **フィルター切替**: 50ms以内
- **設定保存**: 200ms以内

#### 1.2 スキャン性能
- **小規模ページ (< 100リンク)**: 500ms以内
- **中規模ページ (100-1000リンク)**: 2秒以内
- **大規模ページ (> 1000リンク)**: 5秒以内

#### 1.3 メモリ使用量
- **アイドル時**: 5MB以下
- **スキャン実行時**: 20MB以下
- **メモリリーク**: なし

### 2. スケーラビリティ
- **最大処理リンク数**: 10,000リンク
- **正規表現複雑度**: 実用的なパターンに対応
- **同時処理**: 1タブずつの順次処理

---

## 配布・インストール

### 1. 配布チャネル

#### 1.1 Chrome Web Store
- **主要配布方法**: 公式ストア
- **審査プロセス**: Google審査通過
- **更新配信**: 自動更新

#### 1.2 手動インストール
- **開発者向け**: GitHub経由
- **インストール方法**: 開発者モードでの読み込み

### 2. システム要件
- **ブラウザ**: Google Chrome 88以降
- **OS**: Chrome対応OS全て
- **権限**: ユーザー承認が必要

### 3. 更新戦略
- **自動更新**: Chrome Web Store経由
- **バージョン管理**: セマンティックバージョニング
- **後方互換性**: 設定データの互換性保持

---

## 品質保証

### 1. テスト要件

#### 1.1 機能テスト
- 全フィルタリング方法の動作確認
- 様々なウェブサイトでの動作検証
- エラーケースの処理確認

#### 1.2 互換性テスト
- Chrome最新版および前2バージョン
- 主要OSでの動作確認
- 様々な画面解像度での表示確認

#### 1.3 パフォーマンステスト
- 大量リンクページでの性能測定
- メモリ使用量の監視
- 長時間使用での安定性確認

### 2. リリース基準
- 全機能の正常動作
- セキュリティ脆弱性なし
- 主要ブラウザでの動作確認
- 多言語表示の正確性

---

## 今後の拡張計画

### 1. 短期計画 (v1.1 - v1.2)
- 他ブラウザ対応 (Edge, Firefox)
- エクスポート機能 (JSON, CSV)
- カスタム正規表現ライブラリ

### 2. 中期計画 (v1.3 - v2.0)
- リンクプレビュー機能
- バッチ処理対応
- 高度なフィルタリング組み合わせ

### 3. 長期計画 (v2.0+)
- リンク検証機能
- チーム共有機能
- API連携機能

---

## 付録

### A. 技術参考資料
- [Chrome Extension Documentation](https://developer.chrome.com/docs/extensions/)
- [Manifest V3 Migration Guide](https://developer.chrome.com/docs/extensions/migrating/)
- [Web Extensions API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions)

### B. 関連リポジトリ
- **GitHub**: https://github.com/username/linkre
- **Chrome Web Store**: (審査中)

### C. ライセンス
- **ライセンス**: MIT License
- **オープンソース**: GitHub で公開
- **コントリビューション**: 歓迎

---

**文書バージョン**: 1.0  
**最終更新**: 2025年1月  
**作成者**: Linkre開発チーム